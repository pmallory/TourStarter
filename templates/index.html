<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>TourStarter</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Le styles -->
    <link href="static/css/bootstrap.css" rel="stylesheet">
    <link href="static/css/bootstrap-responsive.css" rel="stylesheet">
    <style type="text/css">
        html { height: 100% }
        body { height: 100%; padding-top: 60px }
        #map_canvas { height:100%; }
    </style>

    <link href="static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js">
      </script>
    <![endif]-->
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="static/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="static/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="static/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="static/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="static/ico/apple-touch-icon-57-precomposed.png">

    <script type="text/javascript"
        src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDykrMkn6lahPJnEnHsPVyixue0sgVyBvs&sensor=false">
    </script>

    <script>
        $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
    </script>

    <script type="text/javascript">
        var map;

        var directionsDisplay;
        var directionsService = new google.maps.DirectionsService();

        function initialize() {
            $('#calculate').click(calcRoute);

            var rendererOptions = { draggable: true };
            directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
            var mapOptions = {
                center: new google.maps.LatLng(39.300299, -100.722656),
                zoom: 4,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                panControl: true,
                zoomControl: true,
                mapTypeControl: true,
                scaleControl: true,
                streetViewControl: true
            };
            map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

            directionsDisplay.setMap(map);
            directionsDisplay.setPanel(document.getElementById("text_panel"));
        }

        function calcRoute() {
            geocoder = new google.maps.Geocoder();

            var address = $("input[name='address']").val();
            geocoder.geocode({'address': address+' , US', 'region': 'us'}, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    var origin = results[0].geometry.location;

                    $.getJSON($SCRIPT_ROOT + '/_nearest_waypoint', {
                        lat: origin.lat(),
                        lon: origin.lng(),
                        route: 'TODO'
                    }, function(data) {
                        if (data.status == 'sucess') {
                            route_lat = data.result.lat;
                            route_lon = data.result.lon;

                            var destination = new google.maps.LatLng(route_lat, route_lon);

                            var request = {
                               origin: origin,
                               destination: destination,
                               travelMode: google.maps.TravelMode.BICYCLING
                            };

                            directionsService.route(request, function(result, status) {
                                if (status == google.maps.DirectionsStatus.OK) {
                                    directionsDisplay.setDirections(result);
                                } else {
                                    alert("Error calculating directions.");
                                }
                            });
                        } else {
                            // failed to hit the nearest_waypoint controller
                            alert('this is embarrasing');                             }
                    });
                } else {
                    alert("There was an error interpreting your input.");
                }
            });

        }
    </script>

  </head>

  <body onload="initialize()">
    <div class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="#">TourStarter</a>
          <ul class="nav">
            <li><a href="#">About</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="form-inline">
      <!-- TODO autofill major cities-->
        <input type="text" name="address" placeholder="Where are you starting from?">
        <select name="route">
            <option>Route?</option>
            <option>Underground Railroad</option>
            <option>more to come!</option>
        </select>
        <input type="button" class="btn" id="calculate" value="Calculate" onclick="calculate">
      </div>
    </div>

    <div class="container" style="height:70%">
        <div class="row" style="height:100%">
            <div class="span4">
                <div id="text_panel"></div>
            </div>
            <div class="span8" style="height:100%">
                <div id="map_canvas"></div>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">
    </script>
    <script src="static/js/bootstrap.js">
    </script>
  </body>

</html>
